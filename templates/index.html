<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í–µ—Ç–∫–ª–∏–Ω–∏–∫–∞ ¬´–ú—É—Ä–º—è—É¬ª üêæ</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        {% if msg == "not_found" %}
            <div class="alert error">‚ö†Ô∏è –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∞ —É–∂–µ —É–¥–∞–ª–µ–Ω–∞.</div>
        {% elif msg == "added" %}
            <div class="alert success">‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</div>
        {% elif msg == "deleted" %}
            <div class="alert success">üóëÔ∏è –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞!</div>
        {% elif msg == "rescheduled" %}
            <div class="alert success">üîÑ –ó–∞–ø–∏—Å—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞!</div>
        {% elif msg == "past_date" %}
            <div class="alert error">‚ùå –ù–µ–ª—å–∑—è –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–∞—Ç—ã!</div>
        {% endif %}

        <h1>üè• –í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ ¬´–ú—É—Ä–º—è—É¬ª</h1>

        <!-- –£–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats">
            {% if today_count == 0 %}
                üìÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π
            {% else %}
                üìÖ –°–µ–≥–æ–¥–Ω—è –∑–∞–ø–∏—Å–∞–Ω–æ: <strong>{{ today_count }}
                {% if today_count == 1 %}–ø–∏—Ç–æ–º–µ—Ü{% elif today_count in (2,3,4) %}–ø–∏—Ç–æ–º—Ü–∞{% else %}–ø–∏—Ç–æ–º—Ü–µ–≤{% endif %}
                </strong>
            {% endif %}
        </div>

        <div class="form-box">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É</h2>
            <form method="post" action="/add">
                <input type="text" name="pet_name" placeholder="–ò–º—è –ø–∏—Ç–æ–º—Ü–∞" required>
                <input type="text" name="owner_name" placeholder="–í–∞—à–µ –∏–º—è" required>
                <label>–£—Å–ª—É–≥–∞:
                    <select name="service" required>
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                        <option value="–û—Å–º–æ—Ç—Ä">–û—Å–º–æ—Ç—Ä</option>
                        <option value="–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è">–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è</option>
                        <option value="–°—Ç—Ä–∏–∂–∫–∞ –∫–æ–≥—Ç–µ–π">–°—Ç—Ä–∏–∂–∫–∞ –∫–æ–≥—Ç–µ–π</option>
                        <option value="–ß–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ">–ß–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        <option value="–ö–∞—Å—Ç—Ä–∞—Ü–∏—è/—Å—Ç–µ—Ä–∏–ª–∏–∑–∞—Ü–∏—è">–ö–∞—Å—Ç—Ä–∞—Ü–∏—è/—Å—Ç–µ—Ä–∏–ª–∏–∑–∞—Ü–∏—è</option>
                        <option value="–õ–µ—á–µ–Ω–∏–µ">–õ–µ—á–µ–Ω–∏–µ</option>
                    </select>
                </label>
                <input type="date" name="appointment_date" min="{{ today_str }}" required>
                <textarea name="notes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è (–∞–ª–ª–µ—Ä–≥–∏–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏...)"></textarea>
                <button type="submit">–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É</button>
            </form>
        </div>

        <!-- –°—Ä–æ—á–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è -->
        <div class="form-box urgent">
            <h2>‚ö° –°—Ä–æ—á–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
            <form method="post" action="/add-today">
                <input type="text" name="pet_name" placeholder="–ò–º—è –ø–∏—Ç–æ–º—Ü–∞" required style="width: 48%;">
                <input type="text" name="owner_name" placeholder="–í–∞—à–µ –∏–º—è" required style="width: 48%;">
                <select name="service" required style="width: 100%; margin-top: 8px;">
                    <option value="">‚Äî –°—Ä–æ—á–Ω–∞—è —É—Å–ª—É–≥–∞ ‚Äî</option>
                    <option value="–û—Å–º–æ—Ç—Ä">–û—Å–º–æ—Ç—Ä</option>
                    <option value="–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è">–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è</option>
                    <option value="–°—Ç—Ä–∏–∂–∫–∞ –∫–æ–≥—Ç–µ–π">–°—Ç—Ä–∏–∂–∫–∞ –∫–æ–≥—Ç–µ–π</option>
                    <option value="–õ–µ—á–µ–Ω–∏–µ">–õ–µ—á–µ–Ω–∏–µ (—Å—Ä–æ—á–Ω–æ!)</option>
                </select>
                <textarea name="notes" placeholder="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (—Å—Ä–æ—á–Ω–æ!)" style="width: 100%; margin-top: 8px;"></textarea>
                <button type="submit" class="btn-today">üö® –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –°–ï–ì–û–î–ù–Ø</button>
            </form>
        </div>

        <h2>üìã –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h2>
        {% if appointments %}
            <div class="appointments">
                {% for app in appointments %}
                <div class="appointment-card">
                    <div class="info">
                        <div class="pet-info">
                            <strong>{{ app.pet_name }}</strong> ({{ app.owner_name }})
                        </div>
                        <div class="service">–£—Å–ª—É–≥–∞: {{ app.service }}</div>
                        <div class="date">–î–∞—Ç–∞: {{ app.appointment_date }}</div>

                        {% if app.notes %}
                        <div class="notes">
                            <details>
                                <summary>üìã –ü—Ä–∏–º–µ—á–∞–Ω–∏—è</summary>
                                <div class="notes-content">
                                    {{ app.notes | replace("\n", "<br>") | safe }}
                                </div>
                            </details>
                        </div>
                        {% endif %}
                    </div>

                    <div class="actions">
                        <form method="post" action="/delete/{{ app.id }}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')">
                            <button type="submit" class="btn-delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                        <form method="post" action="/reschedule/{{ app.id }}" style="margin-top: 6px;">
                            <input type="date" name="new_date" min="{{ today_str }}" required>
                            <button type="submit" class="btn-reschedule"
                                    onclick="if(!this.form.new_date.value){alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');return false;}">
                                üîÑ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="empty">–ù–µ—Ç –∑–∞—è–≤–æ–∫. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º! üò∫</p>
        {% endif %}
    </div>
</body>
</html>